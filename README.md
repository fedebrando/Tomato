# Tomato

Let us indicate the root project folder with `/`.

## Setup
Follow these steps to set up the project.

1. Clone this repo on the UniPr cluster
1. Run the following two commands to use conda
    ```bash
    module load miniconda3
    source "$CONDA_PREFIX/etc/profile.d/conda.sh"
    ```

1. Create a conda virtual environment using the YAML file: from root `/` run the following command replacing `env_name` with a new one that you prefer
    ```bash
    conda env create -f environment.yml -n env_name
    ```

## Training
The entry point of training is in the script `/src/train.py`. To run a train, open the bash script `/hpc_launch.bash` and modify the following main parts.

- **Job name** (at line 9). It is also the name of the output file generated by the cluster.
- **Conda environment name** (at line 21). Replace the name written in the script with your environment one.
- **Training starter command** (at line 23). Configure your line-command optional parameters as you prefer, following the table below.

    | Param  | Description | Example (default)     |
    |-------|----|-----------|
    |`--epochs`|number of epochs|`--epochs=500`|
    |`--bs`|number of elements in batch size|`--bs=16`|
    |`--print_every`|print losses every N iteration|`--print_every=5`|
    |`--early_stop`|number of non improvements on validation accuracy to stop training|`--early_stop=5`|
    |`--lr`|learning rate|`--lr=1e-3`|
    |`--opt`|optimizer used for training|`--opt=Adam`|
    |`--aug_flip`|data augmentation with flip|`--aug_flip=0`|
    |`--aug_rotate`|data augmentation with rotate|`--aug_rotate=0`|
    |`--aug_jitter`|data augmentation with color jitter|`--aug_jitter=0`|
    |`--aug_crop`|data augmentation with crop|`--aug_crop=0`|
    |`--refine_model`|refine model of path received|`--refine_model=""`|

Now, you can start training running the command below from `/`.
```bash
    sbatch hpc_launch.bash
```

## Testing
For a model testing, the entry point is in the script `/src/test.py`. To test your model on the test set, you can run the following command from `/`, where `--model_name` must be set with your model name.
```bash
    python ./src/test.py --model_name=best
```

## Notes
To change percentages for the validation set or the test set, modify their relative constants in the script `/src/params.py`.

